---
name: prometheus
author: Geoff Franks <geoff.franks@gmail.com>
homepage: https://github.com/cloudfoundry-community/prometheus-boshrelease
github: https://github.com/genesis-community/prometheus-genesis-kit

subkits:
- prompt: Do you wish to monitor Cloud Foundry?
  subkit: cf
- prompt: Do you wish to monitor a Postgres instance?
  subkit: postgres
- prompt: Do you wish to monitor Elastic Search?
  subkit: elasticsearch
- prompt: Do you wish to monitor RabbitMQ?
  subkit: rabbitmq

params:
  base:
  - param: availability_zones
    description: Override the BOSH AZs that prometheus is deployed on
  - param: disk_pool
    description: Override the persistent disk pool that prometheus uses
  - param: vm_type
    description: Override the BOSH VM type used by the prometheus VM
  - param: network
    description: Override the BOSH network that prometheus is deployed onto

  - param: bosh_host
    description: IP/Hostname of the monitored BOSH instance
    ask: What is the IP/Hostname of the BOSH you wish to monitor and use as service discovery?
  - param: bosh_port
    description: TCP port that the monitored BOSH is listening on
  - param: bosh_ca_cert
    description: Vault path to the CA cert of the monitored BOSH
    ask: What is the Vault path to the CA certificate of the monitored BOSH instance?
    default: secret/${params.vault_prefix}/../bosh/ssl/ca:certificate
    validate: vault_path
  - param: bosh_user
    description: Username for connecting to the monitored BOSH instance
  - param: bosh_password
    description: Vault path to the password of the user being used to monitorBOSH
    ask: What is the Vault path to the password of the user being used to monitor your BOSH instance?
    default: secret/${params.vault_prefix}/../bosh/users/admin:password
    validate: vault_path

  blackbox:
  - param: monitored_endpoints
    description: URLs that should be proped for aliveness
    type: list
    ask: What URLs should prometheus monitor?
  - param: skip_ssl_verify
    description: Should SSL validation be skipped (do you have any self-signed certs in your deployments?)

  postgres:
  - param: pg_host
    description: IP/Hostname of the monitored Postgres instance
    ask: What is the IP/Hostname of the monitored Postgres instance?
  - param: pg_port
    description: TCP port that the monitored Postgres instance is listening on
  - param: pg_sslmode
    description: Determines whether SSL is enabled or disabled when connecting to the monitored Postgres
  - param: pg_user
    description: Username used to connect to the monitored Postgres
  - param: pg_password
    description: Vault path to the password for the monitored Postgres
    ask: What is the Vault path to the monitored Postgres instance's password?
    default: secret/${params.vault_prefix}/../cf/postgres:shield_password
    validate: vault_path

  cf:
  - param: cf_system_domain
    description: System domain of the monitored Cloud Foundry
    ask: What is your Cloud Foundry's system domain?
    example: system.bosh-lite.com
  - param: cf_admin_user
    description: Admin user to connect to the Cloud Foundry API with
  - param: cf_admin_password
    description: Vault path to the password of the Cloud Foundry admin user
    ask: What is the Vault path to your Cloud Foundry's admin user's password?
    default: secret/${params.vault_prefix}/../cf/admin_user:password
    validate: vault_path
  - param: cf_doppler_port
    description: TCP port used to connect to Doppler/the firehose (usually 443 or 4443)
  - param: cf_firehose_client
    description: Name of the UAA Client with the `doppler.firehose` scope to monitor CF with
  - param: cf_firehose_client_secret
    description: Vault path to the client secret of the firehose UAA client
    ask: What is the vault path to the client secret for the firehose UAA client?
    default: secret/${params.vault_prefix}/../cf/uaa/client_secrets:firehose
    validate: vault_path
  - param: cf_deployment
    description: |
      Override the deployment name of your Cloud Foundry (used to find
      the information for connecting to NATS to register routes)
  - param: skip_ssl_validation
    description: Should SSL validation be skipped (do you have any self-signed certs in your CF deployments?)


  elasticsearch:
  - param: elasticsearch_uri
    description: URL of the ElasticSearch master node
    ask: What is the URL of your ElasticSearch master node?

  rabbitmq:
  - param: rabbitmq_url
    description: URL of the monitored RabbitMQ cluster
    ask: What is the URL of your RabbitMQ cluster?
    example: rabbitmq.system.bosh-lite.com
  - param: rabbitmq_user
    description: User to authenticate to RabbitMQ with
  - param: rabbitmq_password
    description: Vault path to the password of the RabbitMQ user
    ask: What is the Vault path to the password of the user monitoring RabbitMQ?
    default: secret/${params.vault_prefix}/../cf-rabbitmq/rabbitmq/client_secrets:admin
    validate: vault_path

credentials:
  base:
    grafanadb:
      password: random 64
    grafana:
      password:   random 64
      secret_key: random 64

certificates:
  base: {}
